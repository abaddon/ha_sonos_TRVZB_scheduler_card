<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Schedule Graph View Component Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      margin: 0;
    }

    .test-container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    h1 {
      margin-top: 0;
    }

    .status {
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 12px;
    }

    .status.info {
      background: #e3f2fd;
      border: 1px solid #2196f3;
      color: #1976d2;
    }

    .status.success {
      background: #e8f5e9;
      border: 1px solid #4caf50;
      color: #2e7d32;
    }

    .status.error {
      background: #ffebee;
      border: 1px solid #f44336;
      color: #c62828;
    }

    #componentContainer {
      margin-top: 20px;
      border: 2px dashed #ccc;
      padding: 20px;
      min-height: 400px;
      background: white;
    }

    .debug-info {
      margin-top: 20px;
      padding: 15px;
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }

    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      background: #2196f3;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background: #1976d2;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>Schedule Graph View Component Test</h1>
    <div class="status info">Loading component...</div>

    <div>
      <button onclick="testWithSampleData()">Load Sample Schedule</button>
      <button onclick="testWithEmptyData()">Test Empty Data</button>
      <button onclick="inspectComponent()">Inspect Component</button>
      <button onclick="checkSVG()">Check SVG Elements</button>
    </div>

    <div id="componentContainer">
      <!-- Component will be inserted here -->
    </div>

    <h2>Debug Information</h2>
    <div id="debugInfo" class="debug-info">Waiting for interaction...</div>
  </div>

  <script type="module">
    // Import the built card bundle
    import '../dist/trvzb-scheduler-card.js';

    let component = null;
    let debugLog = [];

    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      debugLog.push(`[${timestamp}] [${type.toUpperCase()}] ${message}`);
      updateDebugInfo();
      console.log(message);
    }

    function updateDebugInfo() {
      const debugDiv = document.getElementById('debugInfo');
      debugDiv.textContent = debugLog.join('\n');
      debugDiv.scrollTop = debugDiv.scrollHeight;
    }

    function updateStatus(message, type = 'info') {
      const statusDiv = document.querySelector('.status');
      statusDiv.className = `status ${type}`;
      statusDiv.textContent = message;
    }

    window.testWithSampleData = function() {
      log('Testing with sample schedule data');

      // Create sample schedule matching the TRVZB format
      const sampleSchedule = {
        monday: {
          transitions: [
            { time: '00:00', temperature: 20 },
            { time: '06:00', temperature: 22 },
            { time: '08:00', temperature: 18 },
            { time: '17:00', temperature: 22 },
            { time: '22:00', temperature: 18 }
          ]
        },
        tuesday: {
          transitions: [
            { time: '00:00', temperature: 20 },
            { time: '06:00', temperature: 22 },
            { time: '08:00', temperature: 18 },
            { time: '17:00', temperature: 22 },
            { time: '22:00', temperature: 18 }
          ]
        },
        wednesday: {
          transitions: [
            { time: '00:00', temperature: 20 },
            { time: '06:00', temperature: 22 },
            { time: '08:00', temperature: 18 },
            { time: '17:00', temperature: 22 },
            { time: '22:00', temperature: 18 }
          ]
        },
        thursday: {
          transitions: [
            { time: '00:00', temperature: 20 },
            { time: '06:00', temperature: 22 },
            { time: '08:00', temperature: 18 },
            { time: '17:00', temperature: 22 },
            { time: '22:00', temperature: 18 }
          ]
        },
        friday: {
          transitions: [
            { time: '00:00', temperature: 20 },
            { time: '06:00', temperature: 22 },
            { time: '08:00', temperature: 18 },
            { time: '17:00', temperature: 22 },
            { time: '22:00', temperature: 18 }
          ]
        },
        saturday: {
          transitions: [
            { time: '00:00', temperature: 20 },
            { time: '08:00', temperature: 22 },
            { time: '22:00', temperature: 18 }
          ]
        },
        sunday: {
          transitions: [
            { time: '00:00', temperature: 20 },
            { time: '08:00', temperature: 22 },
            { time: '22:00', temperature: 18 }
          ]
        }
      };

      log(`Sample schedule: ${JSON.stringify(sampleSchedule, null, 2)}`);

      // Clear container and create component
      const container = document.getElementById('componentContainer');
      container.innerHTML = '';

      component = document.createElement('schedule-graph-view');
      component.schedule = sampleSchedule;
      component.disabled = false;

      log('Component created with properties:');
      log(`  - schedule: ${component.schedule ? 'SET' : 'NULL'}`);
      log(`  - disabled: ${component.disabled}`);

      container.appendChild(component);

      // Wait for component to render
      setTimeout(() => {
        log('Component should be rendered now');
        inspectComponent();
        updateStatus('Sample schedule loaded successfully', 'success');
      }, 500);
    };

    window.testWithEmptyData = function() {
      log('Testing with empty/null schedule');

      const container = document.getElementById('componentContainer');
      container.innerHTML = '';

      component = document.createElement('schedule-graph-view');
      component.schedule = null;

      container.appendChild(component);

      setTimeout(() => {
        log('Component rendered with null schedule');
        inspectComponent();
        updateStatus('Empty schedule test complete', 'success');
      }, 500);
    };

    window.inspectComponent = function() {
      if (!component) {
        log('No component to inspect', 'error');
        updateStatus('No component found', 'error');
        return;
      }

      log('=== Component Inspection ===');
      log(`Component tag: ${component.tagName}`);
      log(`Component in DOM: ${document.body.contains(component)}`);
      log(`Component schedule property: ${component.schedule ? 'SET' : 'NULL'}`);

      if (component.schedule) {
        log(`Days in schedule: ${Object.keys(component.schedule).join(', ')}`);
      }

      // Check shadow root
      if (component.shadowRoot) {
        log('Shadow root: EXISTS');
        const shadowChildren = component.shadowRoot.children;
        log(`Shadow root children count: ${shadowChildren.length}`);

        for (let i = 0; i < shadowChildren.length; i++) {
          const child = shadowChildren[i];
          log(`  Child ${i}: ${child.tagName} - ${child.className || '(no class)'}`);
        }

        // Check for specific elements
        const graphContainer = component.shadowRoot.querySelector('.graph-container');
        log(`Graph container: ${graphContainer ? 'FOUND' : 'NOT FOUND'}`);

        const chartWrapper = component.shadowRoot.querySelector('.chart-wrapper');
        log(`Chart wrapper: ${chartWrapper ? 'FOUND' : 'NOT FOUND'}`);

        const svg = component.shadowRoot.querySelector('.chart-svg');
        log(`SVG element: ${svg ? 'FOUND' : 'NOT FOUND'}`);

        if (svg) {
          const bbox = svg.getBoundingClientRect();
          log(`SVG dimensions: ${bbox.width}x${bbox.height}`);
          log(`SVG children count: ${svg.children.length}`);

          // Check if SVG has content
          if (svg.children.length > 0) {
            log(`SVG has ${svg.children.length} child elements`);
            for (let i = 0; i < Math.min(5, svg.children.length); i++) {
              log(`  SVG child ${i}: ${svg.children[i].tagName}`);
            }
          } else {
            log('SVG has NO children!', 'error');
          }
        }

        const emptyState = component.shadowRoot.querySelector('.empty-state');
        log(`Empty state: ${emptyState ? 'VISIBLE' : 'HIDDEN'}`);

      } else {
        log('Shadow root: NOT FOUND', 'error');
      }

      log('=== End Inspection ===');
      updateStatus('Inspection complete - check debug info', 'info');
    };

    window.checkSVG = function() {
      if (!component) {
        log('No component to check', 'error');
        return;
      }

      const svg = component.shadowRoot?.querySelector('.chart-svg');
      if (!svg) {
        log('SVG element not found', 'error');
        updateStatus('SVG not found in component', 'error');
        return;
      }

      log('=== SVG Check ===');
      log(`SVG viewBox: ${svg.getAttribute('viewBox')}`);
      log(`SVG preserveAspectRatio: ${svg.getAttribute('preserveAspectRatio')}`);

      const computedStyle = window.getComputedStyle(svg);
      log(`SVG computed width: ${computedStyle.width}`);
      log(`SVG computed height: ${computedStyle.height}`);
      log(`SVG computed display: ${computedStyle.display}`);
      log(`SVG computed visibility: ${computedStyle.visibility}`);
      log(`SVG computed opacity: ${computedStyle.opacity}`);

      // Check parent wrapper
      const wrapper = svg.parentElement;
      if (wrapper) {
        const wrapperStyle = window.getComputedStyle(wrapper);
        log(`Wrapper computed display: ${wrapperStyle.display}`);
        log(`Wrapper computed height: ${wrapperStyle.height}`);
      }

      log('=== End SVG Check ===');
      updateStatus('SVG check complete', 'info');
    };

    // Auto-load sample data on page load
    window.addEventListener('load', () => {
      log('Page loaded, initializing test');
      setTimeout(() => {
        testWithSampleData();
      }, 100);
    });

  </script>
</body>
</html>
